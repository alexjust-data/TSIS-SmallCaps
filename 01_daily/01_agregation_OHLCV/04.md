
## Certificado [*Fuente de verdad*] - Data descargada 

Ping a Polygon a los años requeridos, descargamos ***[Rango de fechas]*** con datos, por cada tiker.

### 2004 / 2018 : ping a Polygon por año a Tickers con *[Rango de fechas]*.

```sh
cd "D:\TSIS_SmallCaps"
python scripts/utils/ping_polygon_range.py
    --tickers "processed/universe/smallcaps_universe_2004_2018.parquet"
    --out "processed/universe/ping_range_2004_2018.parquet"
    --start-date "2004-01-01"
    --end-date "2018-12-31"
    --workers 8

[2025-11-18 18:24:22] Tickers cargados: 5,168
[2025-11-18 18:24:22] Rango: 2004-01-01 -> 2018-12-31
[2025-11-18 18:24:22] Workers: 8
...
[2025-11-18 18:27:39] Guardado: processed/universe/ping_range_2004_2018.parquet
[2025-11-18 18:27:39] Resumen: 3477 con datos / 1691 sin datos

====

# Código ejecutado en 
#`D:\TSIS_SmallCaps\01_daily\01_agregation_OHLCV\01_ohlcv.ipynb`
shape: (5, 4)
ticker	has_data	first_day	last_day
str	bool	str	str
"TVA"	false	null	null
"UVV"	true	"2004-01-02"	"2018-12-31"
"SSLT"	true	"2013-09-09"	"2015-05-08"
"LIDR"	false	null	null
"EDUC"	true	"2004-01-02"	"2018-12-31"

====

Total tickers: 5168
has_data = True : 3477
has_data = False: 1691
```
***[*Fuente de verdad*]***
* *`3477`* Total tickers con rangos en algún año 2004 / 2018
* Ejemplo [*Rango de fechas*] en Polygon para `UVV` : [`2013-09-09` - `2015-05-08`] 
* scripts : `scripts/utils/ping_polygon_range.py`
* output : `processed/universe/ping_range_2004_2018.parquet`

### 2018 / 2025 :  ping a Polygon por año a Tickers con *[Rango de fechas]*.

```sh
PS D:\TSIS_SmallCaps> 
python scripts/utils/ping_polygon_range.py
>>     --tickers "processed/universe/smallcaps_universe_2025-11-01.parquet"
>>     --out "processed/universe/ping_range_2019_2025.parquet"
>>     --start-date "2019-01-01"
>>     --end-date "2025-11-17"
>>     --workers 8
[2025-11-18 18:36:36] Tickers cargados: 6,405
[2025-11-18 18:36:36] Rango: 2019-01-01 -> 2025-11-17
[2025-11-18 18:36:36] Workers: 8
...
[2025-11-18 18:41:09] Guardado: processed/universe/ping_range_2019_2025.parquet
[2025-11-18 18:41:09] Resumen: 6297 con datos / 108 sin datos

====

# Código ejecutado en `D:\TSIS_SmallCaps\01_daily\01_agregation_OHLCV\01_ohlcv.ipynb`
Schema({'ticker': String, 'has_data': Boolean, 'first_day': String, 'last_day': String})
shape: (5, 4)

ticker	has_data	first_day	last_day
   str	bool	         str	      str
"UCAR"	true	"2023-04-20"	"2025-11-17"
"CCNI"	true	"2019-01-02"	"2019-09-10"
"SNBR"	true	"2019-01-02"	"2025-11-17"
"COOT"	true	"2024-03-22"	"2025-11-17"
"MAMA"	true	"2023-08-02"	"2025-11-17"

=====
Total tickers: 6405
has_data = True : 6297
has_data = False: 108
```
***[*Fuente de verdad*]***  
* *`6297`* Total tickers con rangos en algún año 2018 / 2025
* Ejemplo [*Rango de fechas*] en Polygon para `MAMA` : [`2023-08-02` - `2025-11-17`]
* scripts : `scripts/utils/ping_polygon_range.py `
* output : `processed/universe/ping_range_2019_2025.parquet`

### Comparo [*Rango de fechas*] en Polygon *vs* data local descargada, por Tiker.

Objetivo : certificar que se ha descargado cada [*Rango de fechas*] de Polygon a Local, por Ticker.   
Fuente de verdad:
* output : `processed/universe/ping_range_2004_2018.parquet`
* output : `processed/universe/ping_range_2019_2025.parquet`

```sh
# CHECK PARA 2004_2018 Esperado : 3477

PS D:\TSIS_SmallCaps> 
python scripts/utils/verify_daily_vs_ping.py
>>     --ping processed/universe/ping_range_2004_2018.parquet
>>     --daily-root raw/polygon/ohlcv_daily
>>     --period-start 2004-01-01
>>     --period-end 2018-12-31
>>     --output-prefix verify_daily_2004_2018
[2025-11-19 11:38:19] ================================================================================
[2025-11-19 11:38:19] VERIFICACIÓN DAILY vs PING (rápida, sin consultar Polygon)
[2025-11-19 11:38:19] ================================================================================
[2025-11-19 11:38:19] Cargando ping desde processed/universe/ping_range_2004_2018.parquet
[2025-11-19 11:38:19]   > 3,477 tickers con datos según ping
[2025-11-19 11:38:19] Verificando tickers...
[2025-11-19 11:45:45]   Progreso: 500/3477 (14.4%)
[2025-11-19 11:46:05]   Progreso: 1000/3477 (28.8%)
[2025-11-19 11:47:52]   Progreso: 1500/3477 (43.1%)
[2025-11-19 11:50:05]   Progreso: 2000/3477 (57.5%)
[2025-11-19 11:50:09]   Progreso: 2500/3477 (71.9%)
[2025-11-19 11:50:58]   Progreso: 3000/3477 (86.3%)
[2025-11-19 11:54:13]   Progreso: 3477/3477 (100.0%)
[2025-11-19 11:54:13] 
[2025-11-19 11:54:13] ================================================================================
[2025-11-19 11:54:13] RESULTADOS
[2025-11-19 11:54:13] ================================================================================
[2025-11-19 11:54:13] Total tickers verificados:       3,477
[2025-11-19 11:54:13]   ✅ COMPLETOS (match perfecto):  3,477 (100.0%)
[2025-11-19 11:54:13]   ❌ FALTANTES (no descargados):  0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  COMIENZA TARDE:             0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  TERMINA ANTES:              0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  DESAJUSTE:                  0 (0.0%)
[2025-11-19 11:54:13] 
[2025-11-19 11:54:13] Guardando archivos...
[2025-11-19 11:54:14]   ✅ verify_daily_2004_2018_final_full.csv
[2025-11-19 11:54:14] 
[2025-11-19 11:54:14] ================================================================================
[2025-11-19 11:54:14] VERIFICACIÓN COMPLETADA
[2025-11-19 11:54:14] ================================================================================
```

```sh
# CHECK PARA 2019_2025 - Esperado : 6297

PS D:\TSIS_SmallCaps> python scripts/utils/verify_daily_vs_ping.py
>>     --ping processed/universe/ping_range_2019_2025.parquet
>>     --daily-root raw/polygon/ohlcv_daily
>>     --period-start 2019-01-01
>>     --period-end 2025-11-17
>>     --output-prefix verify_daily_2019_2025
[2025-11-19 12:19:25] ================================================================================
[2025-11-19 12:19:25] VERIFICACIÓN DAILY vs PING (rápida, sin consultar Polygon)
[2025-11-19 12:19:25] ================================================================================
[2025-11-19 12:19:25] Cargando ping desde processed/universe/ping_range_2019_2025.parquet
[2025-11-19 12:19:25]   > 6,297 tickers con datos según ping
[2025-11-19 12:19:25] Verificando tickers...
[2025-11-19 12:19:29]   Progreso: 500/6297 (7.9%)
[2025-11-19 12:19:32]   Progreso: 1000/6297 (15.9%)
[2025-11-19 12:19:36]   Progreso: 1500/6297 (23.8%)
[2025-11-19 12:19:40]   Progreso: 2000/6297 (31.8%)
[2025-11-19 12:19:43]   Progreso: 2500/6297 (39.7%)
[2025-11-19 12:19:47]   Progreso: 3000/6297 (47.6%)
[2025-11-19 12:19:51]   Progreso: 3500/6297 (55.6%)
[2025-11-19 12:19:55]   Progreso: 4000/6297 (63.5%)
[2025-11-19 12:19:58]   Progreso: 4500/6297 (71.5%)
[2025-11-19 12:20:02]   Progreso: 5000/6297 (79.4%)
[2025-11-19 12:20:06]   Progreso: 5500/6297 (87.3%)
[2025-11-19 12:20:10]   Progreso: 6000/6297 (95.3%)
[2025-11-19 12:20:12]   Progreso: 6297/6297 (100.0%)
[2025-11-19 12:20:12] 
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] RESULTADOS
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] Total tickers verificados:       6,297
[2025-11-19 12:20:12]   ✅ COMPLETOS (match perfecto):  6,297 (100.0%)
[2025-11-19 12:20:12]   ❌ FALTANTES (no descargados):  0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  COMIENZA TARDE:             0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  TERMINA ANTES:              0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  DESAJUSTE:                  0 (0.0%)
[2025-11-19 12:20:12]
[2025-11-19 12:20:12] Guardando archivos...
[2025-11-19 12:20:12]   ✅ verify_daily_2019_2025_full.csv
[2025-11-19 12:20:12] 
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] VERIFICACIÓN COMPLETADA
[2025-11-19 12:20:12] ================================================================================
```


### Ping Polygon : Descarga completa del ***intervalo*** de tiks por [*Rango de fechas*] por Ticker

Tenemos descarga verificada por [*Rango de fechas*]- [*first_day* \ *last_day*]  desde polygon, por cada tiker:
- `D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily`
- --period-start  `2004-01-01`    
- --period-end  `2025-11-17`     

Por ejemplo tenemos para `RNVA` descargados los días [*Rango de fechas*]:  
```sh
# show_trading_days.py (para cualquier otro ticker/año:)

PS D:\TSIS_SmallCaps> 
python D:\TSIS_SmallCaps\scripts\utils\show_trading_days.py RNVA 2016

Ticker: RNVA
Path  : C:\TSIS_Data\trades_ticks_2004_2018_v2\RNVA\
Years : 2015 - 2017
Dates : 2015-11-03 to 2017-10-24
Total : 498 trading days (all years), 252 trading days (2016)

Month, days (year 2016 only)
2016-01    4,5,6,7,8,11,12,13,14,15,19,20,21,22,25,26,27,28,29
2016-02    1,2,3,4,5,8,9,10,11,12,16,17,18,19,22,23,24,25,26,29
2016-03    1,2,3,4,7,8,9,10,11,14,15,16,17,18,21,22,23,24,28,29,30,31
2016-04    1,4,5,6,7,8,11,12,13,14,15,18,19,20,21,22,25,26,27,28,29
2016-05    2,3,4,5,6,9,10,11,12,13,16,17,18,19,20,23,24,25,26,27,31
2016-06    1,2,3,6,7,8,9,10,13,14,15,16,17,20,21,22,23,24,27,28,29,30
2016-07    1,5,6,7,8,11,12,13,14,15,18,19,20,21,22,25,26,27,28,29
2016-08    1,2,3,4,5,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31
2016-09    1,2,6,7,8,9,12,13,14,15,16,19,20,21,22,23,26,27,28,29,30
2016-10    3,4,5,6,7,10,11,12,13,14,17,18,19,20,21,24,25,26,27,28,31
2016-11    1,2,3,4,7,8,9,10,11,14,15,16,17,18,21,22,23,25,28,29,30
2016-12    1,2,5,6,7,8,9,12,13,14,15,16,19,20,21,22,23,27,28,29,30
```

Ahora vamos a comparar [*Rango de fechas*] en descargas local: 
* [*Rango de fechas*] descargados en `D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily` certificado, por ping a Poligon.
* [*Rango de fechas*] descargados de ***ticks*** en :

```sh
C:\TSIS_Data\trades_ticks_2004_2018_v2\{TICKER}\
└── year={YYYY}\
    └── month={MM}\
        └── day={YYYY-MM-DD}\
            ├── premarket.parquet    # Trades 04:00-09:30 ET
            └── market.parquet       # Trades 09:30-16:00 ET

C:\TSIS_Data\trades_ticks_2019_2025\{TICKER}\
└── year={YYYY}\
    └── month={MM}\
        └── day={YYYY-MM-DD}\
            ├── premarket.parquet    # Trades 04:00-09:30 ET
            └── market.parquet       # Trades 09:30-16:00 ET
```

```sh
# Verificar 2004-2018 (solo años 2004-2018)

PS D:\TSIS_SmallCaps> 
>> python D:\TSIS_SmallCaps\scripts\utils\verify_ticks_vs_daily.py `
>>     --daily-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily `
>>     --ticks-root "C:\TSIS_Data\trades_ticks_2004_2018" `
>>     --ping-range D:\TSIS_SmallCaps\processed\universe\ping_range_2004_2018.parquet `
>>     --output-prefix verify_ticks_2004_2018_fixed `
>>     --year-min 2004 `
>>     --year-max 2018
[2025-11-19 16:41:37] ================================================================================
[2025-11-19 16:41:37] VERIFICACIÓN TICKS vs DAILY (usando daily local como fuente de verdad)
[2025-11-19 16:41:37] ================================================================================
[2025-11-19 16:41:37] Cargando ping desde D:\TSIS_SmallCaps\processed\universe\ping_range_2004_2018.parquet
[2025-11-19 16:41:38]   > 3,477 tickers con datos según ping
[2025-11-19 16:41:38] Filtrando años: 2004 - 2018
[2025-11-19 16:41:38] Verificando tickers...
[2025-11-19 16:49:43]   Progreso: 500/3477 (14.4%)
[2025-11-19 16:57:26]   Progreso: 1000/3477 (28.8%)
[2025-11-19 17:05:11]   Progreso: 1500/3477 (43.1%)
[2025-11-19 17:11:32]   Progreso: 2000/3477 (57.5%)
[2025-11-19 17:17:46]   Progreso: 2500/3477 (71.9%)
[2025-11-19 17:24:01]   Progreso: 3000/3477 (86.3%)
[2025-11-19 17:30:29]   Progreso: 3477/3477 (100.0%)
[2025-11-19 17:30:29] 
[2025-11-19 17:30:29] ================================================================================
[2025-11-19 17:30:29] RESULTADOS
[2025-11-19 17:30:29] ================================================================================
[2025-11-19 17:30:29] Total tickers verificados:       3,477
[2025-11-19 17:30:29]   ✅ COMPLETOS:                   1,484 (42.7%)
[2025-11-19 17:30:29]   ⚠️  DÍAS FALTANTES:              624 (17.9%)
[2025-11-19 17:30:29]   ❌ TICKER FALTANTE:              1,369 (39.4%)
[2025-11-19 17:30:29]
[2025-11-19 17:30:29] Guardando archivos...
[2025-11-19 17:30:29]   ✅ verify_ticks_2004_2018_fixed_full.csv
[2025-11-19 17:30:29]   ✅ verify_ticks_2004_2018_fixed_problems.csv
[2025-11-19 17:30:32]   ✅ verify_ticks_2004_2018_fixed_missing_dates.csv
[2025-11-19 17:30:32]      Total fechas faltantes: 3,499,849
[2025-11-19 17:30:32]
[2025-11-19 17:30:32] ================================================================================
[2025-11-19 17:30:32] VERIFICACIÓN COMPLETADA
[2025-11-19 17:30:32] ================================================================================
```


```sh
PS D:\TSIS_SmallCaps> python D:\TSIS_SmallCaps\scripts\utils\verify_ticks_vs_daily.py `
>>     --daily-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily `
>>     --ticks-root "C:\TSIS_Data\trades_ticks_2019_2025" `
>>     --ping-range D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet `
>>     --output-prefix verify_ticks_2019_2025_fixed `
>>     --year-min 2019 `
>>     --year-max 2025
[2025-11-19 16:42:48] ================================================================================
[2025-11-19 16:42:48] VERIFICACIÓN TICKS vs DAILY (usando daily local como fuente de verdad)
[2025-11-19 16:42:48] ================================================================================
[2025-11-19 16:42:48] Cargando ping desde D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet
[2025-11-19 16:42:48]   > 6,297 tickers con datos según ping
[2025-11-19 16:42:48] Filtrando años: 2019 - 2025
[2025-11-19 16:42:48] Verificando tickers...
[2025-11-19 16:47:19]   Progreso: 500/6297 (7.9%)
[2025-11-19 16:52:15]   Progreso: 1000/6297 (15.9%)
[2025-11-19 16:56:54]   Progreso: 1500/6297 (23.8%)
[2025-11-19 17:01:38]   Progreso: 2000/6297 (31.8%)
[2025-11-19 17:06:05]   Progreso: 2500/6297 (39.7%)
[2025-11-19 17:10:01]   Progreso: 3000/6297 (47.6%)
[2025-11-19 17:13:49]   Progreso: 3500/6297 (55.6%)
[2025-11-19 17:17:33]   Progreso: 4000/6297 (63.5%)
[2025-11-19 17:21:22]   Progreso: 4500/6297 (71.5%)
[2025-11-19 17:25:36]   Progreso: 5000/6297 (79.4%)
[2025-11-19 17:30:00]   Progreso: 5500/6297 (87.3%)
[2025-11-19 17:33:56]   Progreso: 6000/6297 (95.3%)
[2025-11-19 17:36:05]   Progreso: 6297/6297 (100.0%)
[2025-11-19 17:36:05] 
[2025-11-19 17:36:05] ================================================================================
[2025-11-19 17:36:05] RESULTADOS
[2025-11-19 17:36:05] ================================================================================
[2025-11-19 17:36:05] Total tickers verificados:       6,297
[2025-11-19 17:36:05]   ✅ COMPLETOS:                   2,755 (43.8%)
[2025-11-19 17:36:05]   ⚠️  DÍAS FALTANTES:              3,514 (55.8%)
[2025-11-19 17:36:05]   ❌ TICKER FALTANTE:              28 (0.4%)
[2025-11-19 17:36:05] 
[2025-11-19 17:36:05] Guardando archivos...
[2025-11-19 17:36:05]   ✅ verify_ticks_2019_2025_fixed_full.csv
[2025-11-19 17:36:05]   ✅ verify_ticks_2019_2025_fixed_problems.csv
[2025-11-19 17:36:05]   ✅ verify_ticks_2019_2025_fixed_missing_dates.csv
[2025-11-19 17:36:05]      Total fechas faltantes: 427,734
[2025-11-19 17:36:05]
[2025-11-19 17:36:05] ================================================================================
[2025-11-19 17:36:05] VERIFICACIÓN COMPLETADA
[2025-11-19 17:36:05] ================================================================================
```

```sh
# INGEST DÍAS FALTANTES 2019/25: 3,514 (55.8%)
PS D:\TSIS_SmallCaps> 
python scripts/01_agregation_OHLCV/ingest_missing_ticks.py 
  --missing-csv verify_ticks_2019_2025_fixed_missing_dates.csv 
  --outdir C:\TSIS_Data\trades_ticks_2019_2025
  --workers 10

[2025-11-19 17:49:20] ================================================================================
[2025-11-19 17:49:20] DESCARGA DE TICKS FALTANTES
[2025-11-19 17:49:20] ================================================================================
[2025-11-19 17:49:20] Cargando fechas faltantes desde verify_ticks_2019_2025_fixed_missing_dates.csv
[2025-11-19 17:49:20]   Total fechas a descargar: 427,734
[2025-11-19 17:49:20]   Tickers únicos: 3,542
[2025-11-19 17:49:20]   Ticker con más fechas faltantes: CGC (1726 días)
[2025-11-19 17:49:20]
[2025-11-19 17:49:20] Comenzando descarga paralela con 10 workers...
[2025-11-19 17:49:24]   Progreso: 1/427734 (0.0%) | Rate: 0.3 req/s | ETA: 27782.0 min | Success: 1 | 
...
[2025-11-20 09:16:43]   Progreso: 427600/427734 (100.0%) | Rate: 7.7 req/s | ETA: 0.3 min | Success: 427590 | Errors: 10
[2025-11-20 09:16:52]   Progreso: 427700/427734 (100.0%) | Rate: 7.7 req/s | ETA: 0.1 min | Success: 427690 | Errors: 10
[2025-11-20 09:16:56] 
[2025-11-20 09:16:56] ================================================================================
[2025-11-20 09:16:56] DESCARGA COMPLETADA
[2025-11-20 09:16:56] ================================================================================
[2025-11-20 09:16:56] Total fechas procesadas: 427,734
[2025-11-20 09:16:56]   Exitosas: 427,724 (100.0%)
[2025-11-20 09:16:56]   Errores: 10 (0.0%)
[2025-11-20 09:16:56] Tiempo total: 927.6 minutos
[2025-11-20 09:16:56] Velocidad promedio: 7.7 fechas/segundo
```

```sh
PS D:\TSIS_SmallCaps> python scripts\01_agregation_OHLCV\ingest_missing_ticks.py 
>>   --missing-csv verify_ticks_2004_2018_fixed_missing_dates.csv 
>>   --outdir "C:\TSIS_Data\trades_ticks_2004_2018" 
>>   --workers 12
[2025-11-20 09:24:48] ================================================================================
[2025-11-20 09:24:48] DESCARGA DE TICKS FALTANTES
[2025-11-20 09:24:48] ================================================================================
[2025-11-20 09:24:48] Cargando fechas faltantes desde verify_ticks_2004_2018_fixed_missing_dates.csv
[2025-11-20 09:24:50]   Total fechas a descargar: 3,499,849
[2025-11-20 09:24:50]   Tickers únicos: 1,993
[2025-11-20 09:24:50]   Ticker con más fechas faltantes: NAT (3775 días)
[2025-11-20 09:24:50] 
[2025-11-20 09:24:50] Comenzando descarga paralela con 12 workers...
[2025-11-20 09:25:22]   Progreso: 1/3499849 (0.0%) | Rate: 0.0 req/s | ETA: 1857957.7 min | Success: 1 | Errors: 0
[2025-11-20 09:25:23]   Progreso: 100/3499849 (0.0%) | Rate: 3.0 req/s | ETA: 19275.9 min | Success: 100 | Errors: 0
[2025-11-20 09:25:24]   Progreso: 200/3499849 (0.0%) | Rate: 5.9 req/s | ETA: 9949.2 min | Success: 200 | Errors: 0
```

### Ping a Polygon : Comparo ***intervalo completo*** en el [*Rango de fechas*] por Tiker vs data local descargada. 2004/25

Esta noche