
# Certificado [*Fuente de verdad*] - Data descargada 



## 2004 / 2025 : descarga de *[Rango de fechas]* con datos en cada ticker.

Ping a la API de Polygon para encontrar el primer y último día con datos de cada ticker en un rango de fechas usando solo 2 requests por ticker (muy
  eficiente), y guarda el resultado en parquet con las columnas: ticker, has_data, first_day, last_day.

**2004 / 2018**


* *`3477`* Total tickers con rangos en algún año 2004 / 2018
* Ejemplo [*Rango de fechas*] en Polygon para `UVV` : [`2013-09-09` - `2015-05-08`] 
* scripts : `scripts/utils/ping_polygon_range.py`
* output : `processed/universe/ping_range_2004_2018.parquet` ***[*Fuente de verdad*]***

```sh
cd "D:\TSIS_SmallCaps"
python scripts/utils/ping_polygon_range.py
    --tickers "processed/universe/smallcaps_universe_2004_2018.parquet"
    --out "processed/universe/ping_range_2004_2018.parquet"
    --start-date "2004-01-01"
    --end-date "2018-12-31"
    --workers 8

[2025-11-18 18:24:22] Tickers cargados: 5,168
[2025-11-18 18:24:22] Rango: 2004-01-01 -> 2018-12-31
[2025-11-18 18:24:22] Workers: 8
...
[2025-11-18 18:27:39] Guardado: processed/universe/ping_range_2004_2018.parquet
[2025-11-18 18:27:39] Resumen: 3477 con datos / 1691 sin datos

====

# Código ejecutado en 
#`D:\TSIS_SmallCaps\01_daily\01_agregation_OHLCV\01_ohlcv.ipynb`
shape: (5, 4)
ticker	has_data	first_day	last_day
str	bool	str	str
"TVA"	false	null	null
"UVV"	true	"2004-01-02"	"2018-12-31"
"SSLT"	true	"2013-09-09"	"2015-05-08"
"LIDR"	false	null	null
"EDUC"	true	"2004-01-02"	"2018-12-31"

====

Total tickers: 5168
has_data = True : 3477
has_data = False: 1691
```


**2019 / 2025**

* *`6297`* Total tickers con rangos en algún año 2018 / 2025
* Ejemplo [*Rango de fechas*] en Polygon para `MAMA` : [`2023-08-02` - `2025-11-17`]
* scripts : `scripts/utils/ping_polygon_range.py `
* output : `processed/universe/ping_range_2019_2025.parquet` ***[*Fuente de verdad*]***

```sh
PS D:\TSIS_SmallCaps> 
python scripts/utils/ping_polygon_range.py
>>     --tickers "processed/universe/smallcaps_universe_2025-11-01.parquet"
>>     --out "processed/universe/ping_range_2019_2025.parquet"
>>     --start-date "2019-01-01"
>>     --end-date "2025-11-17"
>>     --workers 8
[2025-11-18 18:36:36] Tickers cargados: 6,405
[2025-11-18 18:36:36] Rango: 2019-01-01 -> 2025-11-17
[2025-11-18 18:36:36] Workers: 8
...
[2025-11-18 18:41:09] Guardado: processed/universe/ping_range_2019_2025.parquet
[2025-11-18 18:41:09] Resumen: 6297 con datos / 108 sin datos

====

# Código ejecutado en `D:\TSIS_SmallCaps\01_daily\01_agregation_OHLCV\01_ohlcv.ipynb`
Schema({'ticker': String, 'has_data': Boolean, 'first_day': String, 'last_day': String})
shape: (5, 4)

ticker	has_data	first_day	last_day
   str	bool	         str	      str
"UCAR"	true	"2023-04-20"	"2025-11-17"
"CCNI"	true	"2019-01-02"	"2019-09-10"
"SNBR"	true	"2019-01-02"	"2025-11-17"
"COOT"	true	"2024-03-22"	"2025-11-17"
"MAMA"	true	"2023-08-02"	"2025-11-17"

=====
Total tickers: 6405
has_data = True : 6297
has_data = False: 108
```



## 2004 / 2025 : descarga de ``ohlcv_daily``

Descarga cada [*Rango de fechas*] de Polygon a Local `ohlcv_daily` , por Ticker.   

* *Fuente de verdad* : `processed/universe/ping_range_2004_2018.parquet`
* *Fuente de verdad* : `processed/universe/ping_range_2019_2025.parquet`

```sh
# 2004_2018 CHECK PARA ohlcv_daily - Esperado : 3477
PS D:\TSIS_SmallCaps> 
python scripts/utils/verify_daily_vs_ping.py
>>     --ping processed/universe/ping_range_2004_2018.parquet
>>     --daily-root raw/polygon/ohlcv_daily
>>     --period-start 2004-01-01
>>     --period-end 2018-12-31
>>     --output-prefix verify_daily_2004_2018

[2025-11-19 11:38:19] ================================================================================
[2025-11-19 11:38:19] VERIFICACIÓN DAILY vs PING (rápida, sin consultar Polygon)
[2025-11-19 11:38:19] ================================================================================
[2025-11-19 11:38:19] Cargando ping desde processed/universe/ping_range_2004_2018.parquet
[2025-11-19 11:38:19]   > 3,477 tickers con datos según ping
[2025-11-19 11:38:19] Verificando tickers...
[2025-11-19 11:45:45]   Progreso: 500/3477 (14.4%)
[2025-11-19 11:46:05]   Progreso: 1000/3477 (28.8%)
[2025-11-19 11:47:52]   Progreso: 1500/3477 (43.1%)
[2025-11-19 11:50:05]   Progreso: 2000/3477 (57.5%)
[2025-11-19 11:50:09]   Progreso: 2500/3477 (71.9%)
[2025-11-19 11:50:58]   Progreso: 3000/3477 (86.3%)
[2025-11-19 11:54:13]   Progreso: 3477/3477 (100.0%)
[2025-11-19 11:54:13] 
[2025-11-19 11:54:13] ================================================================================
[2025-11-19 11:54:13] RESULTADOS
[2025-11-19 11:54:13] ================================================================================
[2025-11-19 11:54:13] Total tickers verificados:       3,477
[2025-11-19 11:54:13]   ✅ COMPLETOS (match perfecto):  3,477 (100.0%)
[2025-11-19 11:54:13]   ❌ FALTANTES (no descargados):  0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  COMIENZA TARDE:             0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  TERMINA ANTES:              0 (0.0%)
[2025-11-19 11:54:13]   ⚠️  DESAJUSTE:                  0 (0.0%)
[2025-11-19 11:54:13] 
[2025-11-19 11:54:13] Guardando archivos...
[2025-11-19 11:54:14]   ✅ verify_daily_2004_2018_final_full.csv
[2025-11-19 11:54:14] 
[2025-11-19 11:54:14] ================================================================================
[2025-11-19 11:54:14] VERIFICACIÓN COMPLETADA
[2025-11-19 11:54:14] ================================================================================
```

```sh
# 2019_2025 CHECK PARA ohlcv_daily - Esperado : 6297
PS D:\TSIS_SmallCaps> python scripts/utils/verify_daily_vs_ping.py
>>     --ping processed/universe/ping_range_2019_2025.parquet
>>     --daily-root raw/polygon/ohlcv_daily
>>     --period-start 2019-01-01
>>     --period-end 2025-11-17
>>     --output-prefix verify_daily_2019_2025
[2025-11-19 12:19:25] ================================================================================
[2025-11-19 12:19:25] VERIFICACIÓN DAILY vs PING (rápida, sin consultar Polygon)
[2025-11-19 12:19:25] ================================================================================
[2025-11-19 12:19:25] Cargando ping desde processed/universe/ping_range_2019_2025.parquet
[2025-11-19 12:19:25]   > 6,297 tickers con datos según ping
[2025-11-19 12:19:25] Verificando tickers...
[2025-11-19 12:19:29]   Progreso: 500/6297 (7.9%)
[2025-11-19 12:19:32]   Progreso: 1000/6297 (15.9%)
[2025-11-19 12:19:36]   Progreso: 1500/6297 (23.8%)
[2025-11-19 12:19:40]   Progreso: 2000/6297 (31.8%)
[2025-11-19 12:19:43]   Progreso: 2500/6297 (39.7%)
[2025-11-19 12:19:47]   Progreso: 3000/6297 (47.6%)
[2025-11-19 12:19:51]   Progreso: 3500/6297 (55.6%)
[2025-11-19 12:19:55]   Progreso: 4000/6297 (63.5%)
[2025-11-19 12:19:58]   Progreso: 4500/6297 (71.5%)
[2025-11-19 12:20:02]   Progreso: 5000/6297 (79.4%)
[2025-11-19 12:20:06]   Progreso: 5500/6297 (87.3%)
[2025-11-19 12:20:10]   Progreso: 6000/6297 (95.3%)
[2025-11-19 12:20:12]   Progreso: 6297/6297 (100.0%)
[2025-11-19 12:20:12] 
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] RESULTADOS
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] Total tickers verificados:       6,297
[2025-11-19 12:20:12]   ✅ COMPLETOS (match perfecto):  6,297 (100.0%)
[2025-11-19 12:20:12]   ❌ FALTANTES (no descargados):  0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  COMIENZA TARDE:             0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  TERMINA ANTES:              0 (0.0%)
[2025-11-19 12:20:12]   ⚠️  DESAJUSTE:                  0 (0.0%)
[2025-11-19 12:20:12]
[2025-11-19 12:20:12] Guardando archivos...
[2025-11-19 12:20:12]   ✅ verify_daily_2019_2025_full.csv
[2025-11-19 12:20:12] 
[2025-11-19 12:20:12] ================================================================================
[2025-11-19 12:20:12] VERIFICACIÓN COMPLETADA
[2025-11-19 12:20:12] ================================================================================
```


## 2004 / 2025 : descarga de `ticks`

Actualmente tenemos:  
* Datos 100% verificados por rangos en `D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily`
* verificados desde --period-start  `2004-01-01`    
* verificados hasta --period-end  `2025-11-17`
* Por ejemplo tenemos para `RNVA:`  
    ```sh
    # show_trading_days.py (para cualquier otro ticker/año:)
    python D:\TSIS_SmallCaps\scripts\utils\show_trading_days.py RNVA 2016

    Ticker: RNVA
    Path  : C:\TSIS_Data\trades_ticks_2004_2018_v2\RNVA\
    Years : 2015 - 2017 # rango de años que ha cotizado
    Dates : 2015-11-03 to 2017-10-24 # [first_day* \ *last_day]
    Total : 498 trading days (all years), 252 trading days (2016)

    Month, days (year 2016 only) # ejemplo de días en 2016 por meses
    2016-01    4,5,6,7,8,11,12,13,14,15,19,20,21,22,25,26,27,28,29
    2016-02    1,2,3,4,5,8,9,10,11,12,16,17,18,19,22,23,24,25,26,29
    2016-03    1,2,3,4,7,8,9,10,11,14,15,16,17,18,21,22,23,24,28,29,30,31
    2016-04    1,4,5,6,7,8,11,12,13,14,15,18,19,20,21,22,25,26,27,28,29
    2016-05    2,3,4,5,6,9,10,11,12,13,16,17,18,19,20,23,24,25,26,27,31
    2016-06    1,2,3,6,7,8,9,10,13,14,15,16,17,20,21,22,23,24,27,28,29,30
    2016-07    1,5,6,7,8,11,12,13,14,15,18,19,20,21,22,25,26,27,28,29
    2016-08    1,2,3,4,5,8,9,10,11,12,15,16,17,18,19,22,23,24,25,26,29,30,31
    2016-09    1,2,6,7,8,9,12,13,14,15,16,19,20,21,22,23,26,27,28,29,30
    2016-10    3,4,5,6,7,10,11,12,13,14,17,18,19,20,21,24,25,26,27,28,31
    2016-11    1,2,3,4,7,8,9,10,11,14,15,16,17,18,21,22,23,25,28,29,30
    2016-12    1,2,5,6,7,8,9,12,13,14,15,16,19,20,21,22,23,27,28,29,30
    ```

1. **DESCARGO** `tiks` en cada [*Rango de fechas*] de Polygon a Local por Ticker.
2. **COMPARO** [*Rango de fechas*] en `ticks` descargados vs  `ohlcv_daily` descargados

    * --daily-root `D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily` ***fuente verdad***
    * --ticks-root `"C:\TSIS_Data\trades_ticks_2004_2018"` tiks descargados en local

   > OJO, comparo rango de fechas, nunca se verifica si dentro de ese rango hay data

```sh
# 2004-2018 -  2da ITERACION
# 
# 2004-2018 VERIFICACIÓN TICKS vs DAILY (usando daily-root local como fuente de verdad)
# Esta 100% completo porque es 2da iteracion

PS C:\Users\AlexJ> 
python D:\TSIS_SmallCaps\scripts\utils\verify_ticks_vs_daily.py `
     --daily-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily `
     --ticks-root "C:\TSIS_Data\trades_ticks_2004_2018" `
     --ping-range D:\TSIS_SmallCaps\processed\universe\ping_range_2004_2018.parquet `
     --output-prefix verify_ticks_2004_2018_fixed `
     --year-min 2004 `
     --year-max 2018
[2025-11-25 08:14:51] ================================================================================
[2025-11-25 08:14:51] VERIFICACIÓN TICKS vs DAILY (usando daily local como fuente de verdad)
[2025-11-25 08:14:51] ================================================================================
[2025-11-25 08:14:51] Cargando ping desde D:\TSIS_SmallCaps\processed\universe\ping_range_2004_2018.parquet
[2025-11-25 08:14:51]   > 3,477 tickers con datos según ping
[2025-11-25 08:14:51] Filtrando años: 2004 - 2018
[2025-11-25 08:14:51] Verificando tickers...
[2025-11-25 08:22:11]   Progreso: 500/3477 (14.4%)
[2025-11-25 08:29:34]   Progreso: 1000/3477 (28.8%)
[2025-11-25 08:36:24]   Progreso: 1500/3477 (43.1%)
[2025-11-25 08:42:57]   Progreso: 2000/3477 (57.5%)
[2025-11-25 08:49:43]   Progreso: 2500/3477 (71.9%)
[2025-11-25 08:57:46]   Progreso: 3000/3477 (86.3%)
[2025-11-25 09:04:54]   Progreso: 3477/3477 (100.0%)
[2025-11-25 09:04:54]
[2025-11-25 09:04:54] ================================================================================
[2025-11-25 09:04:54] RESULTADOS
[2025-11-25 09:04:54] ================================================================================
[2025-11-25 09:04:54] Total tickers verificados:       3,477
[2025-11-25 09:04:54]   ✅ COMPLETOS:                   3,477 (100.0%)
[2025-11-25 09:04:54]   ⚠️  DÍAS FALTANTES:              0 (0.0%)
[2025-11-25 09:04:54]   ❌ TICKER FALTANTE:              0 (0.0%)
[2025-11-25 09:04:54]
[2025-11-25 09:04:54] Guardando archivos...
[2025-11-25 09:04:54]   ✅ verify_ticks_2004_2018_fixed_full.csv
[2025-11-25 09:04:54]
[2025-11-25 09:04:54] ================================================================================
[2025-11-25 09:04:54] VERIFICACIÓN COMPLETADA
[2025-11-25 09:04:54] ================================================================================
```


```sh  
# 2019-2025 VERIFICACIÓN TICKS vs DAILY (usando daily-root local como fuente de verdad)
# Esta 100% completo porque es 2da iteracion

PS D:\TSIS_SmallCaps> 
python D:\TSIS_SmallCaps\scripts\utils\verify_ticks_vs_daily.py `
     --daily-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily `
     --ticks-root "C:\TSIS_Data\trades_ticks_2019_2025" `
     --ping-range D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet `
     --output-prefix verify_ticks_2019_2025_fixed `
     --year-min 2019 `
     --year-max 2025

[2025-11-25 09:21:43] ================================================================================
[2025-11-25 09:21:43] VERIFICACIÓN TICKS vs DAILY (usando daily local como fuente de verdad)
[2025-11-25 09:21:43] ================================================================================
[2025-11-25 09:21:43] Cargando ping desde D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet
[2025-11-25 09:21:43]   > 6,297 tickers con datos según ping
[2025-11-25 09:21:43] Filtrando años: 2019 - 2025
[2025-11-25 09:21:43] Verificando tickers...
[2025-11-25 09:25:32]   Progreso: 500/6297 (7.9%)
[2025-11-25 09:30:08]   Progreso: 1000/6297 (15.9%)
[2025-11-25 09:34:58]   Progreso: 1500/6297 (23.8%)
[2025-11-25 09:39:39]   Progreso: 2000/6297 (31.8%)
[2025-11-25 09:44:22]   Progreso: 2500/6297 (39.7%)
[2025-11-25 09:49:27]   Progreso: 3000/6297 (47.6%)
[2025-11-25 09:54:28]   Progreso: 3500/6297 (55.6%)
[2025-11-25 09:59:27]   Progreso: 4000/6297 (63.5%)
[2025-11-25 10:04:19]   Progreso: 4500/6297 (71.5%)
[2025-11-25 10:07:59]   Progreso: 5000/6297 (79.4%)
[2025-11-25 10:10:47]   Progreso: 5500/6297 (87.3%)
[2025-11-25 10:14:03]   Progreso: 6000/6297 (95.3%)
[2025-11-25 10:16:00]   Progreso: 6297/6297 (100.0%)
[2025-11-25 10:16:00]
[2025-11-25 10:16:00] ================================================================================
[2025-11-25 10:16:00] RESULTADOS
[2025-11-25 10:16:00] ================================================================================
[2025-11-25 10:16:00] Total tickers verificados:       6,297
[2025-11-25 10:16:00]   ✅ COMPLETOS:                   6,297 (100.0%)
[2025-11-25 10:16:00]   ⚠️  DÍAS FALTANTES:              0 (0.0%)
[2025-11-25 10:16:00]   ❌ TICKER FALTANTE:              0 (0.0%)
[2025-11-25 10:16:00]
[2025-11-25 10:16:00] Guardando archivos...
[2025-11-25 10:16:00]   ✅ verify_ticks_2019_2025_fixed_full.csv
[2025-11-25 10:16:00]
[2025-11-25 10:16:00] ================================================================================
[2025-11-25 10:16:00] VERIFICACIÓN COMPLETADA
[2025-11-25 10:16:00] ================================================================================
```

```sh
# DESCARGA DE TICKS FALTANTES 2019 - 2025
PS D:\TSIS_SmallCaps
python scripts/01_agregation_OHLCV/ingest_missing_ticks.py `
  --missing-csv verify_ticks_2019_2025_fixed_missing_dates.csv `
  --outdir C:\TSIS_Data\trades_ticks_2019_2025 `
  --workers 18
```

```sh
# DESCARGA DE TICKS FALTANTES 2004 - 2018
PS D:\TSIS_SmallCaps> 
python scripts\01_agregation_OHLCV\ingest_missing_ticks.py 
>>   --missing-csv verify_ticks_2004_2018_fixed_missing_dates.csv 
>>   --outdir "C:\TSIS_Data\trades_ticks_2004_2018" 
>>   --workers 18
```

Path

```sh
C:\TSIS_Data\trades_ticks_2004_2018_v2\{TICKER}\
└── year={YYYY}\
    └── month={MM}\
        └── day={YYYY-MM-DD}\
            ├── premarket.parquet    # Trades 04:00-09:30 ET
            └── market.parquet       # Trades 09:30-16:00 ET

C:\TSIS_Data\trades_ticks_2019_2025\{TICKER}\
└── year={YYYY}\
    └── month={MM}\
        └── day={YYYY-MM-DD}\
            ├── premarket.parquet    # Trades 04:00-09:30 ET
            └── market.parquet       # Trades 09:30-16:00 ET
  ```

## 2004 / 2025 : descarga de `1m`

1. **DESCARGO** `INTRADAY 1M` en cada [*Rango de fechas*] de Polygon a Local por Ticker.
2. **COMPARO** [*Rango de fechas*] en `INTRADAY 1M` descargados vs  `ohlcv_daily` descargados


- *[Fuente de verdad]* : `ping_range_2004_2018.parquet`
- *[Fuente de verdad]* : `ping_range_2019_2025.parquet`

```sh
# 2004-2018  Descarga INTRADAY 1M 2004-2018 
# 
PS D:\TSIS_SmallCaps> 
python scripts\01_agregation_OHLCV\ingest_intraday_ultra_fast.py `
>>   --tickers-csv processed/universe/ping_range_2004_2018.parquet `
>>   --outdir C:\TSIS_Data\ohlcv_intraday_1m\2004_2018 `
>>   --daily-dir raw/polygon/ohlcv_daily\2004_2018 `
>>   --start-year 2004 `
>>   --end-year 2018 `
>>   --concurrent 60
Tickers: 5168
============================================================
DESCARGA ULTRA-RÁPIDA DE INTRADAY 1M
============================================================
Tickers: 5,168
Período: 2004-2018
Concurrencia: 60
Daily dir: raw\polygon\ohlcv_daily\2004_2018
[16:14:54] 20/5168 (0.4%) | 0.49 tickers/s | ETA: 174.4m | Rows: 5.2M | Skip: 0
...
[19:06:56] 5160/5168 (99.8%) | 0.50 tickers/s | ETA: 0.3m | Rows: 1102.5M | Skip: 0
[19:07:04] 5168/5168 (100.0%) | 0.50 tickers/s | ETA: 0.0m | Rows: 1102.9M | Skip: 0

============================================================
COMPLETADO en 2.88 horas
Páginas: 313,265
Filas: 1,102,866,374
Meses saltados: 0
Errores: 59
Velocidad: 106337 rows/s


# 2004-2018 VERIFICACIÓN 1m vs *[Fuente de verdad]* `ping_range_2004_2018.parquet`
# 
PS D:\TSIS_SmallCaps> 
python "scripts\utils\verify_all_intraday_1m.py" `
>>   --year-min 2004 `
>>   --year-max 2018 `
>>   --data-dir "C:\TSIS_Data\ohlcv_intraday_1m\2004_2018" `
>>   --daily-root "raw/polygon/ohlcv_daily" `
>>   --universe-file "processed/universe/ping_range_2004_2018.parquet" `
>>   --workers 16
Cargando tickers desde processed/universe/ping_range_2004_2018.parquet...
Total tickers a verificar: 3,477
Período: 2004-2018
Workers: 16

Verificando tickers en paralelo...
Verificando: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3477/3477 [07:59<00:00,  7.25ticker/s]

======================================================================
RESUMEN DE VERIFICACIÓN
======================================================================
Total tickers: 3,477
  ✅ Completos:      3,464 (99.6%)
  ⚠️  Incompletos:    12 (0.3%)
  ℹ️  Sin daily data: 0 (0.0%)
  ❌ Errores:        1 (0.0%)

Completitud promedio: 100.0%

Meses esperados:   314,612
Meses descargados: 314,646
Meses faltantes:   12

======================================================================
TICKERS INCOMPLETOS (12):
----------------------------------------------------------------------
  PUMP     97.7%  (43/44 meses)  Faltan: 1
  LVNTB    98.1%  (53/54 meses)  Faltan: 1
  LPCN     98.3%  (57/58 meses)  Faltan: 1
  RDIB     99.0%  (99/100 meses)  Faltan: 1
  AOSL     99.0%  (104/105 meses)  Faltan: 1
  REX      99.3%  (136/137 meses)  Faltan: 1
  ALGT     99.3%  (144/145 meses)  Faltan: 1
  TRST     99.4%  (179/180 meses)  Faltan: 1
  LION     99.4%  (179/180 meses)  Faltan: 1
  QUIK     99.4%  (179/180 meses)  Faltan: 1
  DSWL     99.4%  (179/180 meses)  Faltan: 1
  PLCE     99.4%  (179/180 meses)  Faltan: 1
======================================================================


# 2004-2018 GENERANDO UNIVERSO INCOMPLETO (tikers incompletos)
# 
# 1. Crear el parquet filtrado con los 1,399 tickers incompletos
python "scripts\utils\create_incomplete_universe_2004_2018.py"

# 2. Relanzar descarga solo para los incompletos
python scripts\01_agregation_OHLCV\ingest_intraday_ultra_fast.py `
  --tickers-csv processed\universe\ping_range_2004_2018_incomplete.parquet `
  --outdir C:\TSIS_Data\ohlcv_intraday_1m\2004_2018 `
  --daily-dir raw/polygon/ohlcv_daily `
  --start-year 2004 `
  --end-year 2018 `
  --concurrent 60
```


```sh
# 2019-2025  Descarga INTRADAY 1M 2019-2025 
# 
PS D:\TSIS_SmallCaps> 
python scripts\01_agregation_OHLCV\ingest_intraday_ultra_fast.py `
>>   --tickers-csv processed/universe/ping_range_2019_2025.parquet `
>>   --outdir C:\TSIS_Data\ohlcv_intraday_1m\2019_2025 `
>>   --daily-dir raw/polygon/ohlcv_daily `
>>   --start-year 2019 `
>>   --end-year 2025 `
>>   --concurrent 60

============================================================
DESCARGA ULTRA-RÁPIDA DE INTRADAY 1M
============================================================
Tickers: 6,405
Período: 2019-2025
Concurrencia: 60
Daily dir: raw\polygon\ohlcv_daily
[09:41:01] 20/6405 (0.3%) | 0.55 tickers/s | ETA: 191.8m | Rows: 2.6M | Skip: 0
[09:41:42] 40/6405 (0.6%) | 0.52 tickers/s | ETA: 204.3m | Rows: 4.8M | Skip: 0
... 
...
[12:32:50] 6400/6405 (99.9%) | 0.62 tickers/s | ETA: 0.1m | Rows: 918.9M | Skip: 0
[12:32:58] 6405/6405 (100.0%) | 0.62 tickers/s | ETA: 0.0m | Rows: 919.8M | Skip: 0

============================================================
COMPLETADO en 2.88 horas
Páginas: 277,169
Filas: 919,798,171
Meses saltados: 0
Errores: 1,001
Velocidad: 88844 rows/s




# 2019-2025 VERIFICACIÓN 1m vs *[Fuente de verdad]*`ping_range_2019_2025.parquet`
# 
PS D:\TSIS_SmallCaps> 
python "scripts\utils\verify_all_intraday_1m.py" `
>>   --year-min 2019 `
>>   --year-max 2025 `
>>   --data-dir "C:\TSIS_Data\ohlcv_intraday_1m\2019_2025" `
>>   --daily-root "raw/polygon/ohlcv_daily" `
>>   --universe-file "processed/universe/ping_range_2019_2025.parquet" `
>>   --workers 16
Cargando tickers desde processed/universe/ping_range_2019_2025.parquet...
Total tickers a verificar: 6,297
Período: 2019-2025
Workers: 16

Verificando tickers en paralelo...
Verificando: 100%|███████████████████████████████████████████████████████████████████████████████████████████| 6297/6297 [06:59<00:00, 14.99ticker/s]

======================================================================
RESUMEN DE VERIFICACIÓN
======================================================================
Total tickers: 6,297
  ✅ Completos:      6,290 (99.9%)
  ⚠️  Incompletos:    7 (0.1%)
  ℹ️  Sin daily data: 0 (0.0%)
  ❌ Errores:        0 (0.0%)

Completitud promedio: 100.0%

Meses esperados:   277,689
Meses descargados: 277,681
Meses faltantes:   11

======================================================================
TICKERS INCOMPLETOS (7):
----------------------------------------------------------------------
  AEBIV     0.0%  (0/1 meses)  Faltan: 1
  FIEE     91.5%  (54/59 meses)  Faltan: 5
  CMO      97.1%  (33/34 meses)  Faltan: 1
  PPYA     97.4%  (37/38 meses)  Faltan: 1
  PPHI     97.7%  (42/43 meses)  Faltan: 1
  JAMF     98.7%  (75/76 meses)  Faltan: 1
  TLSA     98.8%  (82/83 meses)  Faltan: 1

TICKERS SIN DATOS DESCARGADOS (1):
----------------------------------------------------------------------
  AEBIV   Esperados: 1 meses
======================================================================



# 2019-2025 GENERANDO UNIVERSO INCOMPLETO (tikers incompletos)
#
# 1. Crear el parquet filtrado con los 1,399 tickers incompletos
python "scripts\utils\create_incomplete_universe.py"

# 2. Relanzar descarga solo para los incompletos
PS D:\TSIS_SmallCaps> python scripts\01_agregation_OHLCV\ingest_intraday_ultra_fast.py `
>>   --tickers-csv processed\universe\ping_range_2019_2025_incomplete.parquet `
>>   --outdir C:\TSIS_Data\ohlcv_intraday_1m\2019_2025 `
>>   --daily-dir raw/polygon/ohlcv_daily `
>>   --start-year 2019 `
>>   --end-year 2025 `
>>   --concurrent 60
```

**VERIFICO DESCARGA `INTRADAY 1M` comparo *[Rango de fechas]* vs `ohlcv_daily`**

> OJO, comparo *[Rango de fechas]*, nunca se verifica si dentro de ese rango la data está completo.

***Script:*** `D:\TSIS_SmallCaps\scripts\02_final\verify_intraday_improved.py`    
Verifica que los datos intraday de 1 minuto estén completos comparándolos con los datos daily por *[Rango de fechas]*, detecta archivos faltantes o corruptos, mide la calidad de los
  datos (gaps, completitud) y genera reportes detallados usando procesamiento paralelo.
  
* --daily-root `D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily`     
* --intraday-root `C:\TSIS_Data\ohlcv_intraday_1m`   

```sh
# 2019-2025 VERIFICACIÓN 1m vs DAILY (usando daily-root local como fuente de verdad)
# Está 100% completo porque
PS C:\Users\AlexJ> python D:\TSIS_SmallCaps\scripts\02_final\verify_intraday_improved.py `
>>   --daily-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_daily `
>>   --intraday-root D:\TSIS_SmallCaps\raw\polygon\ohlcv_intraday_1m `
>>   --ping-range D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet `
>>   --output-prefix verify_intraday_2019_2025 `
>>   --year-min 2019 `
>>   --year-max 2025 `
>>   --workers 12 `
>>   --use-cache `
>>   --quality-threshold 80

[2025-11-24 18:05:04] ================================================================================
[2025-11-24 18:05:04] VERIFICACIÓN MEJORADA INTRADAY vs DAILY
[2025-11-24 18:05:04] ================================================================================
[2025-11-24 18:05:04] Cargando ping desde D:\TSIS_SmallCaps\processed\universe\ping_range_2019_2025.parquet
[2025-11-24 18:05:04]   > 6,297 tickers con datos
[2025-11-24 18:05:04] Filtrando años: 2019 - 2025
[2025-11-24 18:05:04] Verificando tickers con 12 workers...
[2025-11-24 18:06:19]   Progreso: 100/6297 (1.6%)
... 
... 
[2025-11-24 23:42:51]   Progreso: 6200/6297 (98.5%)
[2025-11-24 23:45:22]
[2025-11-24 23:45:22] ================================================================================
[2025-11-24 23:45:22] RESULTADOS
[2025-11-24 23:45:22] ================================================================================
[2025-11-24 23:45:22] Total tickers verificados:       6,297
[2025-11-24 23:45:22]   ✅ COMPLETOS:                  0 (0.0%)
[2025-11-24 23:45:22]   ⚠️ MESES FALTANTES:            0 (0.0%)
[2025-11-24 23:45:22]   ⚠️ PROBLEMAS DE CALIDAD:       6,296 (100.0%)
[2025-11-24 23:45:22]   ❌ TICKER FALTANTE:            1 (0.0%)
Traceback (most recent call last):
```



---



### Ping a Polygon : Comparo ***intervalo completo*** dentro del [*Rango de fechas*] por Tiker vs data local descargada. 2004/25

Esta noche

